{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'css/intelbuild.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Intel PC Build</title>
</head>
<script>
    function showPopup(message) {
        const popup = document.createElement('div');
        popup.classList.add('popup');
        popup.textContent = message;
        document.body.appendChild(popup);
    
        setTimeout(() => {
            popup.classList.add('show');
        }, 10);
    
        setTimeout(() => {
            popup.classList.remove('show');
            setTimeout(() => popup.remove(), 300); 
        }, 2000);
    }
    
    function addToCart(productId, isIntel = false, isAMD = false) {
        const url = isIntel ? `/product/intel/${productId}/add-to-cart/` :
                    isAMD ? `/product/amd/${productId}/add-to-cart/` :
                    `/product/${productId}/add-to-cart/`;
    
        fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}', 
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ productId })
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error('Failed to add item to cart');
            }
        })
        .then(data => {
            if (data.success) {
                showPopup('Item added to cart!');
            } else {
                showPopup('Failed to add item to cart');
            }
        })
        .catch(error => {
            console.error('Error adding to cart:', error);
            showPopup('Item added to cart');
        });
    }  
</script>


<body>
    <header>
        <h1>PCGeek</h1> 
        <div class="nav-container">
            <nav>
                <a href="{% url 'home' %}">Home</a>
                <a href="{% url 'custom_pc_build' %}">Custom PC Build</a>
    
                {% if user.is_authenticated %}
                <a href="{% url 'cart' %}" class="cart-icon">
                    <i class="fas fa-shopping-cart"></i> Cart
                </a>
                {% else %}
                <a href="{% url 'login' %}?next={% url 'cart' %}" class="cart-icon">
                    <i class="fas fa-shopping-cart"></i> Cart
                </a>
                {% endif %}
    
                {% if user.is_authenticated %}
                <a href="{% url 'profile' %}" class="profile-button">
                    {{ user.username }}
                </a>
                {% else %}
                <a href="{% url 'login' %}" class="profile-button">Profile</a>
                {% endif %}
    
                {% if user.is_authenticated %}

                <form method="post" action="{% url 'logout' %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="logout-button">Logout</button>
                </form>
                {% else %}
                <a href="{% url 'login' %}" class="login-button">Login</a>
                {% endif %}
            </nav>
        </div>
    </header>

    
    <div class="page-heading">
        <h1>Intel PC Build</h1>
    </div>    

    <div class="container">
        <div class="sidebar">
            <ul>
                {% for category in categories %}
                    <li class="{% if category.id|stringformat:"s" == request.GET.category_id %}selected{% endif %}">
                        <a href="?category_id={{ category.id }}">{{ category.name }}</a>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <div class="product-list">
            {% if products %}
                {% for product in products %}
                <div class="product-item">
                    <img src="{{ product.image.url }}" alt="{{ product.name }}">
                    <span>{{ product.name }} - Rs {{ product.price }}</span>
                    <button type="button" class="product-btn" onclick="addToCart('{{ product.id }}', true)">Add to Cart</button>
                </div>
                {% endfor %}
            {% else %}
                <p>Please select a category to view products.</p>
            {% endif %}
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <img src="{% static 'images/logo.png' %}" alt="PCGeek Logo">
            </div>
            <div class="footer-message">
                <p>Buying a laptop in Nepal can be a tough job. Due to the small market, computer stores always bring just a few models of laptops and all with limited stock. So chances of finding a laptop that fits your requirements are feeble. And if you further look at the laptop price in Nepal, you will be shocked to see it being exorbitantly high. Limited availability and the high price of the laptops has definitely created an inconvenience amongst the customers. With a view to solving this problem, PCGeek was established.</p>
            </div>
        </div>
    
        <div class="footer-bottom">
            <p>&copy; 2024 PCGeek - All rights reserved</p>
        </div>
    </footer>
</body>
</html>
